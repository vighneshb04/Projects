"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolveName = resolveName;
const polygon_js_1 = require("../../../chains/chain-definitions/polygon.js");
const contract_js_1 = require("../../../contract/contract.js");
const withCache_js_1 = require("../../../utils/promise/withCache.js");
const reverseNameOf_js_1 = require("../__generated__/UnstoppableDomains/read/reverseNameOf.js");
const consts_js_1 = require("../consts.js");
/**
 * Resolves the primary Untoppable-Domains name for a specified address.
 * @param options - The options for resolving an UD domain
 * @example
 *
 * ### Basic usage
 * ```ts
 * import { resolveName } from "thirdweb/extension/unstoppable-domains";
 *
 * const name = await resolveName({
 *   client,
 *   address: "0x...",
 * });
 * ```
 *
 * ### Custom resolver
 * By default this extension will try to resolve the address on Polygon mainnet,
 * you can decide to customize the resolver contract by specifying `resolverAddress` and `resolverChain`
 * ```ts
 * import { ethereum } from "thirdweb/chains";
 *
 * const address = await resolveName({
 *   client,
 *   address: "0x...",
 *   resolverAddress: "0x...",
 *   resolverChain: ethereum,
 * });
 * ```
 * @extension UNSTOPPABLE-DOMAINS
 */
async function resolveName(options) {
    const { client, address, resolverAddress, resolverChain } = options;
    return (0, withCache_js_1.withCache)(async () => {
        const contract = (0, contract_js_1.getContract)({
            client,
            chain: resolverChain || polygon_js_1.polygon,
            address: resolverAddress || consts_js_1.UD_POLYGON_MAINNET,
        });
        // Note: if the given wallet address does not have any UD name, `reverseNameOf` will return an empty string
        // This can still happen if you have transfered a domain to a new address, and forgot to set up the Reverse Resolution on the new address
        const domain = await (0, reverseNameOf_js_1.reverseNameOf)({ contract, addr: address });
        if (!domain) {
            throw new Error(`Failed to retrieve domain for address: ${address}. Make sure you have set the Reverse Resolution address for your domain at https://unstoppabledomains.com/manage?page=reverseResolution&domain=your-domain`);
        }
        return domain;
    }, {
        cacheKey: `unstoppable-domain:name:${resolverChain?.id || 1}:${address}`,
        // 1min cache
        cacheTime: 60 * 1000,
    });
}
//# sourceMappingURL=resolveName.js.map